{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Invoice #{{ order.id }}</title>
    <style>
        body.browser-mode { background: #f9f9f9; color: #333; font-family: Arial, sans-serif; margin: 20px; }
        body.pdf-mode { background: white; color: #333; font-family: Arial, sans-serif; margin: 20px; }

        .invoice-box {
            background: white;
            padding: 20px;
            border: 1px solid #eee;
            max-width: 800px;
            margin: auto;
        }

        /* HEADER */
        .header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .header .logo,
        .header .address,
        .header .tin {
            flex: 1 1 100%;
            text-align: center;
            margin-bottom: 5px;
        }

        .header .logo img { max-height: 60px; }
        .header .address, .header .tin { font-size: 13px; }

        @media (min-width: 600px) {
            .header .logo { text-align: left; flex: 1; }
            .header .address { flex: 2; text-align:center; }
            .header .tin { text-align: right; flex: 1; }
        }

        h1 { color: #0a0; font-size: 22px; margin-top: 10px; }

        /* TABLE FULL WIDTH */
        table { width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 13px; }
        table th, table td { border: 1px solid #eee; padding: 6px; text-align: left; }
        table th { background: #f3f3f3; }
        .total { text-align: right; font-weight: bold; }

        .terms { margin-top: 30px; font-size: 14px; line-height: 1.6; }

        .invoice-footer {
            margin-top: 40px;
            border-top: 1px solid #ccc;
            padding-top: 20px;
            font-size: 13px;
        }

        .stamp-container, .signature-container {
            background: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 10px;
            max-width: 120px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: auto;
            margin-bottom: 15px;
        }

        .stamp-container img, .signature-container img { max-width: 100%; height: auto; border-radius: 8px; }

        .footer-note {
            text-align: center;
            font-size: 12px;
            margin-top: 40px;
            color: #777;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }

        /* Buttons */
        .btn-container { text-align:center; margin-top: 20px; }
        .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 25px;
        font-size: 15px;
        font-weight: bold;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        margin: 5px;
        transition: all 0.3s ease;
        cursor: pointer;
}

    .btn-icon {
       margin-right: 8px;
       font-size: 18px;
       transition: transform 0.3s ease, text-shadow 0.3s ease;
}

/* Black → Gold Save Button */
.btn-save { background: linear-gradient(45deg, #000000, #FFD700); }
.btn-save:hover { 
    background: linear-gradient(45deg, #333333, #FFC700);
    transform: scale(1.05);
}
.btn-save:hover .btn-icon {
    transform: scale(1.4);
    text-shadow: 0 0 6px #FFD700;
}

/* Green Print Button */
.btn-print { background: linear-gradient(45deg, #00FF66, #008000); }
.btn-print:hover { 
    background: linear-gradient(45deg, #00CC55, #006600);
    transform: scale(1.05);
}
.btn-print:hover .btn-icon {
    transform: scale(1.4);
    text-shadow: 0 0 6px #00FF66;
}

/* Hide buttons when printing */
@media print {
    .btn-container { display: none; }
}

/* Mobile responsiveness */
@media (max-width: 600px) {
    .invoice-box {
        padding: 10px;
        max-width: 100%;
        margin: 10px;
    }

    .header {
        flex-direction: column;
        align-items: center;
        padding-bottom: 10px;
        margin-bottom: 10px;
    }

    .header .logo, .header .address, .header .tin {
        text-align: center;
        margin-bottom: 5px;
    }

    table {
        font-size: 12px;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }

    .btn {
        width: 100%;
        justify-content: center;
        margin: 5px 0;
    }
}


    </style>
</head>
<body class="{% if pdf %}pdf-mode{% else %}browser-mode{% endif %}">

<div class="invoice-box">

    <!-- Header -->
{% if pdf %}
<table style="width:100%; margin-bottom:10px; border-bottom:1px solid #ccc;">
    <tr>
        <td style="width:25%; text-align:left; vertical-align:middle;">
            {% if company_logo %}
                <img src="{{ company_logo }}" alt="Company Logo" style="max-height:60px;">
            {% endif %}
        </td>
        <td style="width:50%; text-align:center; vertical-align:middle; font-size:13px;">
            <strong>Glai Export & Supply</strong><br>
            Mikocheni, Dar es Salaam, Tanzania<br>
            Phone: +255 752 904 157<br>
            Email: info@glaiexportandsupply.online
        </td>
        <td style="width:25%; text-align:right; vertical-align:middle; font-size:13px;">
            <strong>TIN:</strong><br>144-015-223
        </td>
    </tr>
</table>
{% else %}
<div class="header">
    <div class="logo">
        {% if company_logo %}
            <img src="{{ company_logo }}" alt="Company Logo">
        {% endif %}
    </div>
    <div class="address">
        <strong>Glai Export & Supply</strong><br>
        Mikocheni, Dar es Salaam, Tanzania<br>
        Phone: +255 752 904 157<br>
        Email: info@glaiexportandsupply.online
    </div>
    <div class="tin">
        <strong>TIN:</strong><br>144-015-223
    </div>
</div>
{% endif %}


    <!-- Invoice Info -->
    <h1>Invoice Number: {{ order.id|stringformat:"04d" }}</h1>
    <p><strong>Customer:</strong> {{ order.first_name }} {{ order.last_name }}</p>
    <p><strong>Email:</strong> {{ order.email }}</p>
    <p><strong>Phone:</strong> {{ order.phone }}</p>
    <p><strong>Address:</strong> {{ order.address }}</p>
    <p><strong>Date:</strong> {{ now|date:"F j, Y" }}</p>

    <!-- Order Table -->
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Price (Tsh)</th>
                <th>Quantity</th>
                <th>Total (Tsh)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order_items %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.price|intcomma }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.total_price|intcomma }}</td>
                </tr>
            {% endfor %}
            <tr>
                <td colspan="3" class="total">Total:</td>
                <td>{{ total|intcomma }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Bank Info -->
    {% if bank_info %}
    <div style="margin-top: 20px;">
        <h4>Bank Payment Instructions</h4>
        {% if bank_logo_url %}
            <img src="{{ bank_logo_url }}" alt="{{ bank_info.name }} Logo" style="max-height:50px; display:block; margin-bottom:10px;">
        {% endif %}
        <p>{{ bank_info.instructions }}</p>
        <ul>
            <li><strong>Bank:</strong> {{ bank_info.name }}</li>
            <li><strong>Account Name:</strong> {{ bank_info.account_name }}</li>
            <li><strong>Account Number:</strong> {{ bank_info.account_number }}</li>
        </ul>
    </div>
    {% endif %}

    <!-- Terms -->
    <div class="terms">
        <h4>Delivery Terms</h4>
        <p>Delivery within Dar es Salaam, 2–3 Hours, while out of Dar es Salaam 1–3 business days upon order confirmation, unless otherwise specified.</p>

        <h4>Payment Terms</h4>
        <p>Payment is due upon delivery. Late payments may attract additional charges unless prior arrangements are made.</p>
    </div>

    <!-- Footer with Stamp and Signature -->
    <div class="invoice-footer">
        <div style="display: flex; justify-content: center; align-items: flex-start; gap: 40px; flex-wrap: wrap;">
            {% if stamp_image %}
            <div class="stamp-container">
                <img src="{{ stamp_image }}" alt="Company Stamp">
                <div style="margin-top: 5px; font-size: 13px; color: #555;">Authorized Stamp</div>
            </div>
            {% endif %}

            {% if signature_image %}
            <div class="signature-container">
                <img src="{{ signature_image }}" alt="Authorized Signature">
                <div style="margin-top: 5px; font-size: 13px; color: #555;">Authorized Signature</div>
            </div>
            {% endif %}
        </div>

        <div style="text-align: center; margin-top: 15px;">
            <strong>Date:</strong> {% now "F j, Y" %}
        </div>

        <p style="margin-top: 20px; text-align: center;">
            For queries, contact us at info@glaiexportandsupply.online.
        </p>
    </div>

    <!-- Footer Note -->
    <div class="footer-note">
        Thank you for doing business with us! | Glai Export & Supply &copy; {{ now|date:"Y" }}
    </div>
</div>

<!-- Action Buttons -->
{% if not pdf %}
<div class="btn-container">
    <a href="{% url 'orders:invoice_pdf' order.id %}" class="btn btn-save">
        <span class="btn-icon">💾</span> Save Invoice
    </a>
    <button onclick="window.print()" class="btn btn-print">
        <span class="btn-icon">🖨️</span> Print Invoice
    </button>
</div>
{% endif %}


</body>
</html>
